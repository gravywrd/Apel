<html class="scroll-smooth" lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Notifikasi Apel Harian
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col items-center justify-center p-4">
  <div class="max-w-md w-full bg-white rounded-lg shadow-md p-6 text-center">
   <img alt="Ilustrasi apel merah segar dengan daun hijau di latar putih" class="mx-auto mb-4" height="150" loading="lazy" src="https://storage.googleapis.com/a1aa/image/466d9a03-c9ee-4f88-c591-ee86f8c193cc.jpg" width="150"/>
   <h1 class="text-2xl font-semibold mb-2 text-gray-800">
    Notifikasi Apel Harian
   </h1>
   <p class="text-gray-600 mb-4">
    Aplikasi ini akan menampilkan notifikasi setiap hari Selasa, Kamis, dan Jumat pukul 06:30 pagi untuk mengingatkan apel.
   </p>
   <button class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded inline-flex items-center justify-center mx-auto" id="enableNotifBtn">
    <i class="fas fa-bell mr-2">
    </i>
    Aktifkan Notifikasi
   </button>
   <p class="mt-4 text-sm text-gray-700" id="statusMsg">
   </p>
  </div>
  <script>
   // Fungsi untuk cek apakah hari ini Selasa, Kamis, atau Jumat
    function isNotificationDay(date) {
      // getDay(): 0=minggu, 1=senin, 2=selasa, 3=rabu, 4=kamis, 5=jumat, 6=sabtu
      const day = date.getDay();
      return day === 2 || day === 4 || day === 5;
    }

    // Fungsi untuk menampilkan notifikasi apel
    function showApelNotification() {
      const notifTitle = "Pengingat Apel";
      const notifOptions = {
        body: "Hari ini ada apel pukul 06:30. Jangan lupa hadir!",
        icon: "https://placehold.co/128x128/png?text=Apel+Notif",
        badge: "https://placehold.co/64x64/png?text=Apel",
        vibrate: [200, 100, 200],
        tag: "apel-notification",
        renotify: true,
      };
      if (Notification.permission === "granted") {
        new Notification(notifTitle, notifOptions);
      }
    }

    // Fungsi untuk menghitung milidetik sampai jam 6:30 hari ini atau hari berikutnya
    function getMsUntilNextNotification() {
      const now = new Date();
      const today6_30 = new Date(
        now.getFullYear(),
        now.getMonth(),
        now.getDate(),
        6,
        30,
        0,
        0
      );

      if (now < today6_30 && isNotificationDay(now)) {
        // Jika sekarang sebelum jam 6:30 dan hari ini adalah hari apel, notif hari ini jam 6:30
        return today6_30 - now;
      } else {
        // Cari hari apel berikutnya
        let nextDay = new Date(now);
        nextDay.setDate(nextDay.getDate() + 1);
        while (!isNotificationDay(nextDay)) {
          nextDay.setDate(nextDay.getDate() + 1);
        }
        const next6_30 = new Date(
          nextDay.getFullYear(),
          nextDay.getMonth(),
          nextDay.getDate(),
          6,
          30,
          0,
          0
        );
        return next6_30 - now;
      }
    }

    // Fungsi untuk mulai jadwal notifikasi berulang
    function scheduleNotification() {
      const msUntilNext = getMsUntilNextNotification();

      setTimeout(() => {
        showApelNotification();
        // Setelah notif pertama, set interval 24 jam untuk notif berikutnya
        setInterval(() => {
          const now = new Date();
          if (isNotificationDay(now)) {
            showApelNotification();
          }
        }, 24 * 60 * 60 * 1000);
      }, msUntilNext);
    }

    // Fungsi untuk minta izin notifikasi dan mulai jadwal
    function enableNotifications() {
      if (!("Notification" in window)) {
        statusMsg.textContent = "Browser Anda tidak mendukung notifikasi.";
        return;
      }

      if (Notification.permission === "granted") {
        statusMsg.textContent = "Notifikasi sudah diaktifkan.";
        scheduleNotification();
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then((permission) => {
          if (permission === "granted") {
            statusMsg.textContent = "Notifikasi berhasil diaktifkan.";
            scheduleNotification();
          } else {
            statusMsg.textContent = "Izin notifikasi ditolak.";
          }
        });
      } else {
        statusMsg.textContent = "Izin notifikasi sudah ditolak sebelumnya.";
      }
    }

    const enableNotifBtn = document.getElementById("enableNotifBtn");
    const statusMsg = document.getElementById("statusMsg");

    enableNotifBtn.addEventListener("click", () => {
      enableNotifications();
      enableNotifBtn.disabled = true;
      enableNotifBtn.classList.add("opacity-50", "cursor-not-allowed");
    });
  </script>
 </body>
</html>
